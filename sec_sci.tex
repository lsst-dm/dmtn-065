\section{Recommendations to Enable Science from Special Programs}\label{sec:sci}

Recommended implementations for Rubin Data Management to meet the 
requirements related to Special Programs (Section~\ref{sec:req})
and enable science with data from Special Programs.

\subsection{Region and Program Labels}\label{ssec:sci_labels}

\textbf{All visits should have a region label \textit{and} a program 
label, and these labels should be propagated to processed images and catalog data.}

\textbf{Region Labels -- } based on Right Acension and Declination.
Region labels should include, e.g., WFD low-dust, Galactic Plane, Galactic 
Bulge, SCP, NES, or Virgo; DDF fieldname; mini-survey region name.
Region labels should be propagated to processed images (visit, 
difference, and deep coadds), catalog sources, and catalog static-sky objects. 

\textbf{Program Labels -- } 
Based on survey cadeance or strategy.
Program labels might include, e.g., WFD, DDF, TOO, mini-survey name, or other 
options like engineering, commissioning, and director's discretionary.
Program labels should be propagated to single-visit processed and 
difference images and catalog sources.
It would not make sense to propagate program labels to deep coadds or 
object tables, as these data products could be a mix of programs.

There are three main reasons for this recommendation.

\begin{enumerate}

\item To meet the requirement that metadata for observations associated 
with Special Programs is stored, and is sufficient for triggering 
real-time data processing recipes (Section~\ref{ssec:req_meta}).

\item To enable users to query and retrieve processed image and catalog
data associated with a specific Special Program, and meet the science goals
of that Special Program, when regular processing as been applied 
(e.g., Prompt Processing, Section~\ref{ssec:sci_pproc}).

\item To enable provenance when Special Programs data in included in regular
processing and the WFD program data products (e.g., if used to improve the
all-sky coadd).

\end{enumerate}

\subsection{Special Processing}\label{ssec:sci_sproc}

\textbf{Special Processing should be done by Rubin Data Management to 
produce unique and separate (but joinable) data products
for Special Programs when it is both possible and necessary.}

\textbf{Possible -- } When original or reconfigured versions of the LSST
Science Pipelines can be used, and no new algorithmic or software development,
or significant additional computational resources, are needed.

\textbf{Necessary -- } When the primary science goal for a Special Program 
cannot be met by including the data in regular processing (e.g., Prompt processing),
or where doing so would compromise the WFD data products (e.g., introduce non-uniformity).

The definitions of possible and necessary, and the scope of Special Processing,
are ultimately left to the discretion of Rubin Data Management in Operations.
Note that secondary science goals may be considered as ``not necessary".

There are two main reasons for this recommendation.

\begin{enumerate}

\item To meet the requirement that Rubin Observatory produce
unique, separate, and joinable data products whenever this is possible 
with the original or reconfigured versions of the LSST Science Pipelines
(Section~\ref{sec:req}).

\item To enable science with Special Programs by all users, not just those
with the time and effort to process the data, and to reduce computational
load (and potential redundancy) in User-Generated Processing.

\end{enumerate}

Specific examples are provided only to illustrate this recommendation.
These examples do not place limits on what Special Processing might be done.

\begin{itemize}

\item \textbf{Possible and necessary:}
in order to detect high-redshift (faint) galaxies in the DDFs,
Rubin Data Management uses the LSST Science Pipelines to deeply
coadd images for each field, and store the results of source
detection and characterization in unique and separate tables that
are included in the annual data release (Section~\ref{ssec:proc_rdm_ddf}).

\item \textbf{Possible but not necessary:}
a time-domain mini-survey that uses standard visits \emph{could}
have separate difference-image analysis object and source catalogs
generated, but this is not necessary as the science goals for the
mini-survey can be met by processing its data with regular Prompt
Processing (Section~\ref{ssec:sci_pproc}), and ensuring the
data is properly labeled (Section~\ref{ssec:sci_labels}).

\item \textbf{Possible but not necessary (secondary science goals):}
a time-domain mini-survey (or DDF) has a secondary science goal of detecting
precursor outbursts for transients, which requires coadding images
within windows of days, weeks, and months to reach various depths.
This set of custom coadds may be considered as ``not necessary" and requiring 
User-Generated Processing.

\item \textbf{Necessary but not possible:}
in order to find the most distant, faint Kuiper Belt Objects in the DDF,
a specialized, computationally intensive form of ``shift-and-stack" processing
is required for detection, but such algorithms are not used by the 
LSST Science Pipelines and so User-Generated Processing will be needed (Section~\ref{ssec:SPCS_TNO}).
A second example here is a twilight survey that uses non-standard visits 
which are outside the boundaries of what the LSST
Science Pipelines can process (Section~\ref{ssec:proc_bounds}).

\end{itemize}

\subsection{Prompt Processing}\label{ssec:sci_pproc}

\textbf{All visits that \emph{can} be processed by the Prompt pipelines and generate 
alerts \emph{should} be, in support of time domain and Solar System science goals.}

The phrase ``can be processed" includes all standard and alternative visits in 
sky regions for which a template image exists.
This might also include some non-standard visits (shorter or longer exposures), 
as long as they can be processed by the Prompt pipeline and an appropriate template image exists.

Visits with very short or very long exposure times (or very bright sky 
backgrounds) might be excluded if they would need specialized algorithms for,
e.g., instrument signature removal, difference-imaging, template-generation 
(Section~\ref{ssec:proc_bounds}).

If a Special Program's primary science goal requires specialized templates and 
Prompt processing, the Data Management System will have the capability to load 
and use an alternative template for some sky regions, based on the image metadata 
(i.e., the labels described in Section~\ref{ssec:sci_labels}). 
However, there would not be enough memory to hold alternative templates 
for the whole sky.

Including visits from Special Programs in regular Prompt processing alongside
vists from the WFD program is not, in general, anticipated to affect WFD science goals.
For example, analyses for a WFD-only subset could still be done using the program and
region labels described in Section~\ref{ssec:sci_labels}.
However, a few concerns are raised in Section~\ref{ssec:proc_prompt}.

\subsection{Computational Resources for User-Generated Processing}\label{ssec:sci_comp}

Rubin Observatory will reserve 10\% of its total data processing capacity for users.
This is already a requirement, as mentioned in Section~\ref{ssec:req_ug}.
This component would include {\it all} user processing and re-processing of any and 
all LSST data, including Special Programs. 

As described in Section~\ref{ssec:proc_user} this processing capacity will be 
accessed via Rubin Science Platform, with a supported software environment and 
infrastructure for batch processing \citedsp{dmtn-202}.

Very computationally intense processing (e.g., shift-and-stack for faint moving 
objects) will likely require external resources\footnote{For more details about 
the boundary between what Rubin Observatory will provide (in terms of data products 
and processing resources) and what will be left to the expertise of the science community, 
see \url{https://www.lsst.org/about/dm/data-products}}.

\subsection{Rubin Science Platform Capabilities}\label{ssec:sci_rsp}

Users will need to be able to query for data that restricts by sky region and 
program label. 
This can be accomplished by including those labels in all image and catalog 
metadata as described in Section~\ref{ssec:sci_labels}, as the TAP service 
and butler already provide the mechanism for user-specified queries.

Users will need to be able to discover Special Programs data products when 
browsing data.
This could be accomplished with, e.g., a toggle to overlay region boundaries
for Special Programs when browsing all-sky coadds built from WFD program data
in the Portal Aspect.


